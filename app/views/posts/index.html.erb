<% if !params[:username] && !current_user.username %>
  <%= render :partial => 'users/username_form', :locals => { :user => current_user } %>
<% end %>
<% if current_user && @user == current_user %>
<% bookmarklet = "javascript:reading={};(function(){reading.token='#{current_user.token}';var otherlib=(typeof jQuery=='undefined'&&typeof $=='function');function getScript(url,success){var script=document.createElement('script');script.src=url;var head=document.getElementsByTagName('head')[0],done=false;script.onload=script.onreadystatechange=function(){if(!done&&(!this.readyState||this.readyState=='loaded'||this.readyState=='complete')){done=true;success();script.onload=script.onreadystatechange=null;head.removeChild(script);}};head.appendChild(script);}getScript('http://code.jquery.com/jquery-latest.min.js',function(){if(typeof jQuery=='undefined'){alert('There was an error loading jquery');}else{jQuery.getScript('http://0.0.0.0:3000/javascripts/reading.js');}});})();" %>
<%= link_to 'Your Bookmarklet', bookmarklet %>
<% end %>

<div id="content">
<h4><%= @user.first_name %> has been reading</h4>

<table>
<% time = '' %>
<% @posts.each do |post| %>
  <tr>
    <td class="date">
    <%=
      if time != post.created_at.strftime("%m/%d")
        time = post.created_at.strftime("%m/%d")
      end
    %>
    </td>
    <td><%= link_to post.title, post.url, :class => 'external' %></td>
    <% if post.user.id == current_user.id %>
      <td><%= link_to 'Edit', edit_post_path(post), :class => 'admin action' %></td>
      <td><%= link_to 'Delete', post, :class => 'admin action', :confirm => 'Are you sure?', :method => :delete %></td>
    <% end %>
  </tr>
<% end %>
</table>

</div>
