domain = "<%= DOMAIN %>"
if reading?.bypass_cf
  domain = "#{domain.split(".").slice(0,-1).reverse().join("-")}.herokuapp.com"

c = <%= Rails.application.config.requirejs.run_config.to_json %>
c.baseUrl = "//#{domain}/assets"

<% if !['production','staging'].include?(Rails.env) %>
c.config = text: useXhr: -> true
<% end %>

# This manifest is generated by requirejs-rails during `rake assets:precompile`
# and comes down in _loader.js.erb
if reading?.manifest?
  for key, val of reading.manifest
    c.paths[key] = val

require.config c
