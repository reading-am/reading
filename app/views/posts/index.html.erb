<%=
  locals = mustache_helpers.merge({
    pages:     bot? ? page_hashes_from_posts(@posts) : false,
    has_posts: @posts.to_a.size > 0, # run the query first with to_a so that it doesn't make a count() query
  })

  if @user
    has_avatar = @user != current_user or (@user == current_user and !@user.avatar.size.nil?)
    locals.merge!({
      show_blank_slate:   (@user.posts.size == 0 or @user.following.size == 0),
      is_current_user:    @user == current_user,
      avatar_link_url:    has_avatar ? @user.avatar_url : "/settings/info",
      avatar_link_target: has_avatar ? "_blank" : false,
      avatar_img_url:     @user.avatar_url(:medium),
      you_or_name:        @user == current_user ? 'you' : @user.first_name,
      follow_text:        signed_in? && current_user.following?(@user) ? 'unfollow' : 'follow',
      has_followed:       @user.following.size > 0,
      has_link:           !@user.link.blank?,
      has_location:       !@user.location.blank?
    })
  end

  render file: 'posts/index/template', locals: locals
%>

<%=
  if !bot?
    locals = {collection: @posts}
    if @user
      locals[:model] = @user
    else
      locals[:router] = 'users'
    end
    render partial: 'backbone/router', locals: locals
  end
%>
