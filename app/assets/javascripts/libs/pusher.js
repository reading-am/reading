/*!
 * Pusher JavaScript Library v2.0.5
 * http://pusherapp.com/
 *
 * Copyright 2013, Pusher
 * Released under the MIT licence.
 */

define(function(){var b;(function(){function d(a){(a===null||a===void 0)&&b.warn("Warning","You must pass your app key when you instantiate Pusher.")}b=function(a,e){var c=this;this.options=e||{};this.key=a;this.channels=new b.Channels;this.global_emitter=new b.EventsDispatcher;this.sessionID=Math.floor(Math.random()*1E9);d(this.key);this.connection=new b.ConnectionManager(this.key,b.Util.extend({getStrategy:function(a){return b.StrategyBuilder.build(b.getDefaultStrategy(),b.Util.extend({},c.options,
a))},getTimeline:function(){return new b.Timeline(c.key,c.sessionID,{features:b.Util.getClientFeatures(),params:c.options.timelineParams||{},limit:50,level:b.Timeline.INFO,version:b.VERSION})},getTimelineSender:function(a,e){return c.options.disableStats?null:new b.TimelineSender(a,{encrypted:c.isEncrypted()||!!e.encrypted,host:b.stats_host,path:"/timeline"})},activityTimeout:b.activity_timeout,pongTimeout:b.pong_timeout,unavailableTimeout:b.unavailable_timeout},this.options,{encrypted:this.isEncrypted()}));
this.connection.bind("connected",function(){c.subscribeAll()});this.connection.bind("message",function(a){var e=a.event.indexOf("pusher_internal:")===0;if(a.channel){var b=c.channel(a.channel);b&&b.emit(a.event,a.data)}e||c.global_emitter.emit(a.event,a.data)});this.connection.bind("disconnected",function(){c.channels.disconnect()});this.connection.bind("error",function(a){b.warn("Error",a)});b.instances.push(this);b.isReady&&c.connect()};var c=b.prototype;b.instances=[];b.isReady=!1;b.debug=function(){b.log&&
b.log(b.Util.stringify.apply(this,arguments))};b.warn=function(){var a=b.Util.stringify.apply(this,arguments);window.console&&(window.console.warn?window.console.warn(a):window.console.log&&window.console.log(a));b.log&&b.log(a)};b.ready=function(){b.isReady=!0;for(var a=0,e=b.instances.length;a<e;a++)b.instances[a].connect()};c.channel=function(a){return this.channels.find(a)};c.connect=function(){this.connection.connect()};c.disconnect=function(){this.connection.disconnect()};c.bind=function(a,
e){this.global_emitter.bind(a,e);return this};c.bind_all=function(a){this.global_emitter.bind_all(a);return this};c.subscribeAll=function(){for(var a in this.channels.channels)this.channels.channels.hasOwnProperty(a)&&this.subscribe(a)};c.subscribe=function(a){var e=this,b=this.channels.add(a,this);this.connection.state==="connected"&&b.authorize(this.connection.socket_id,this.options,function(c,d){c?b.emit("pusher:subscription_error",d):e.send_event("pusher:subscribe",{channel:a,auth:d.auth,channel_data:d.channel_data})});
return b};c.unsubscribe=function(a){this.channels.remove(a);this.connection.state==="connected"&&this.send_event("pusher:unsubscribe",{channel:a})};c.send_event=function(a,e,b){return this.connection.send_event(a,e,b)};c.isEncrypted=function(){return b.Util.getDocumentLocation().protocol==="https:"?!0:!!this.options.encrypted}}).call(this);(function(){b.Util={now:function(){return Date.now?Date.now():(new Date).valueOf()},extend:function(d){for(var c=1;c<arguments.length;c++){var a=arguments[c],e;
for(e in a)d[e]=a[e]&&a[e].constructor&&a[e].constructor===Object?b.Util.extend(d[e]||{},a[e]):a[e]}return d},stringify:function(){for(var b=["Pusher"],c=0;c<arguments.length;c++)typeof arguments[c]==="string"?b.push(arguments[c]):window.JSON===void 0?b.push(arguments[c].toString()):b.push(JSON.stringify(arguments[c]));return b.join(" : ")},arrayIndexOf:function(b,c){var a=Array.prototype.indexOf;if(b===null)return-1;if(a&&b.indexOf===a)return b.indexOf(c);for(var a=0,e=b.length;a<e;a++)if(b[a]===
c)return a;return-1},keys:function(b){var c=[],a;for(a in b)Object.prototype.hasOwnProperty.call(b,a)&&c.push(a);return c},apply:function(b,c){for(var a=0;a<b.length;a++)c(b[a],a,b)},objectApply:function(b,c){for(var a in b)Object.prototype.hasOwnProperty.call(b,a)&&c(b[a],a,b)},map:function(b,c){for(var a=[],e=0;e<b.length;e++)a.push(c(b[e],e,b,a));return a},mapObject:function(b,c){var a={},e;for(e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=c(b[e]));return a},filter:function(b,c){for(var c=
c||function(a){return!!a},a=[],e=0;e<b.length;e++)c(b[e],e,b,a)&&a.push(b[e]);return a},filterObject:function(b,c){var c=c||function(a){return!!a},a={},e;for(e in b)Object.prototype.hasOwnProperty.call(b,e)&&c(b[e],e,b,a)&&(a[e]=b[e]);return a},flatten:function(b){var c=[],a;for(a in b)Object.prototype.hasOwnProperty.call(b,a)&&c.push([a,b[a]]);return c},any:function(b,c){for(var a=0;a<b.length;a++)if(c(b[a],a,b))return!0;return!1},all:function(b,c){for(var a=0;a<b.length;a++)if(!c(b[a],a,b))return!1;
return!0},method:function(b){var c=Array.prototype.slice.call(arguments,1);return function(a){return a[b].apply(a,c.concat(arguments))}},getDocument:function(){return document},getDocumentLocation:function(){return b.Util.getDocument().location},getLocalStorage:function(){return window.localStorage},getClientFeatures:function(){return b.Util.keys(b.Util.filterObject({ws:b.WSTransport,flash:b.FlashTransport},function(b){return b.isSupported()}))}}}).call(this);(function(){b.VERSION="2.0.5";b.PROTOCOL=
6;b.host="ws.pusherapp.com";b.ws_port=80;b.wss_port=443;b.sockjs_host="sockjs.pusher.com";b.sockjs_http_port=80;b.sockjs_https_port=443;b.sockjs_path="/pusher";b.stats_host="stats.pusher.com";b.channel_auth_endpoint="/pusher/auth";b.cdn_http="http://localhost:5555/";b.cdn_https="http://localhost:5555/";b.dependency_suffix=".min";b.channel_auth_transport="ajax";b.activity_timeout=12E4;b.pong_timeout=3E4;b.unavailable_timeout=1E4;b.getDefaultStrategy=function(){return[[":def","ws_options",{hostUnencrypted:b.host+
":"+b.ws_port,hostEncrypted:b.host+":"+b.wss_port}],[":def","sockjs_options",{hostUnencrypted:b.sockjs_host+":"+b.sockjs_http_port,hostEncrypted:b.sockjs_host+":"+b.sockjs_https_port}],[":def","timeouts",{loop:!0,timeout:15E3,timeoutLimit:6E4}],[":def","ws_manager",[":transport_manager",{lives:2}]],[":def_transport","ws","ws",3,":ws_options",":ws_manager"],[":def_transport","flash","flash",2,":ws_options",":ws_manager"],[":def_transport","sockjs","sockjs",1,":sockjs_options"],[":def","ws_loop",[":sequential",
":timeouts",":ws"]],[":def","flash_loop",[":sequential",":timeouts",":flash"]],[":def","sockjs_loop",[":sequential",":timeouts",":sockjs"]],[":def","strategy",[":cached",18E5,[":first_connected",[":if",[":is_supported",":ws"],[":best_connected_ever",":ws_loop",[":delayed",2E3,[":sockjs_loop"]]],[":if",[":is_supported",":flash"],[":best_connected_ever",":flash_loop",[":delayed",2E3,[":sockjs_loop"]]],[":sockjs_loop"]]]]]]]}}).call(this);(function(){function d(c){var a=function(a){Error.call(this,a);
this.name=c};b.Util.extend(a.prototype,Error.prototype);return a}b.Errors={UnsupportedTransport:d("UnsupportedTransport"),UnsupportedStrategy:d("UnsupportedStrategy"),TransportPriorityTooLow:d("TransportPriorityTooLow"),TransportClosed:d("TransportClosed")}}).call(this);(function(){function d(a){this.callbacks=new c;this.global_callbacks=[];this.failThrough=a}function c(){this._callbacks={}}var a=d.prototype;a.bind=function(a,b){this.callbacks.add(a,b);return this};a.bind_all=function(a){this.global_callbacks.push(a);
return this};a.unbind=function(a,b){this.callbacks.remove(a,b);return this};a.emit=function(a,b){var c;for(c=0;c<this.global_callbacks.length;c++)this.global_callbacks[c](a,b);var g=this.callbacks.get(a);if(g&&g.length>0)for(c=0;c<g.length;c++)g[c](b);else this.failThrough&&this.failThrough(a,b);return this};c.prototype.get=function(a){return this._callbacks[this._prefix(a)]};c.prototype.add=function(a,b){var c=this._prefix(a);this._callbacks[c]=this._callbacks[c]||[];this._callbacks[c].push(b)};
c.prototype.remove=function(a,c){if(this.get(a)){var d=b.Util.arrayIndexOf(this.get(a),c);if(d!==-1){var g=this._callbacks[this._prefix(a)].slice(0);g.splice(d,1);this._callbacks[this._prefix(a)]=g}}};c.prototype._prefix=function(a){return"_"+a};b.EventsDispatcher=d}).call(this);(function(){function d(a){this.options=a;this.loading={};this.loaded={}}function c(a,e){b.Util.getDocument().addEventListener?a.addEventListener("load",e,!1):a.attachEvent("onreadystatechange",function(){(a.readyState==="loaded"||
a.readyState==="complete")&&e()})}function a(a,e){var g=b.Util.getDocument(),d=g.getElementsByTagName("head")[0],g=g.createElement("script");g.setAttribute("src",a);g.setAttribute("type","text/javascript");g.setAttribute("async",!0);c(g,function(){setTimeout(e,0)});d.appendChild(g)}var e=d.prototype;e.load=function(b,e){var c=this;this.loaded[b]?e():(this.loading[b]||(this.loading[b]=[]),this.loading[b].push(e),this.loading[b].length>1||a(this.getPath(b),function(){for(var a=0;a<c.loading[b].length;a++)c.loading[b][a]();
delete c.loading[b];c.loaded[b]=!0}))};e.getRoot=function(a){var e=b.Util.getDocumentLocation().protocol;return(a&&a.encrypted||e==="https:"?this.options.cdn_https:this.options.cdn_http).replace(/\/*$/,"")+"/"+this.options.version};e.getPath=function(a,b){return this.getRoot(b)+"/"+a+this.options.suffix+".js"};b.DependencyLoader=d}).call(this);(function(){function d(){b.ready()}function c(a){document.body?a():setTimeout(function(){c(a)},0)}function a(){c(d)}b.Dependencies=new b.DependencyLoader({cdn_http:b.cdn_http,
cdn_https:b.cdn_https,version:b.VERSION,suffix:b.dependency_suffix});if(!window.WebSocket&&window.MozWebSocket)window.WebSocket=window.MozWebSocket;window.JSON?a():b.Dependencies.load("json2",a)})();(function(){function d(a,b){var c=this;this.timeout=setTimeout(function(){if(c.timeout!==null)b(),c.timeout=null},a)}var c=d.prototype;c.isRunning=function(){return this.timeout!==null};c.ensureAborted=function(){if(this.timeout)clearTimeout(this.timeout),this.timeout=null};b.Timer=d}).call(this);(function(){for(var d=
String.fromCharCode,c=0;c<64;c++)"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(c);var a=function(a){var b=a.charCodeAt(0);return b<128?a:b<2048?d(192|b>>>6)+d(128|b&63):d(224|b>>>12&15)+d(128|b>>>6&63)+d(128|b&63)},e=function(a){var b=[0,2,1][a.length%3],a=a.charCodeAt(0)<<16|(a.length>1?a.charCodeAt(1):0)<<8|(a.length>2?a.charCodeAt(2):0);return["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(a>>>18),"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(a>>>
12&63),b>=2?"=":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(a>>>6&63),b>=1?"=":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(a&63)].join("")},i=window.btoa||function(a){return a.replace(/[\s\S]{1,3}/g,e)};b.Base64={encode:function(b){return i(b.replace(/[^\x00-\x7F]/g,a))}}}).call(this);(function(){function d(a){this.options=a}function c(a){return b.Util.mapObject(a,function(a){typeof a==="object"&&(a=JSON.stringify(a));return encodeURIComponent(b.Base64.encode(a.toString()))})}
d.send=function(a,c){var d=new b.JSONPRequest({url:a.url,receiver:a.receiverName,tagPrefix:a.tagPrefix}),g=a.receiver.register(function(a,b){d.cleanup();c(a,b)});return d.send(g,a.data,function(b){var c=a.receiver.unregister(g);c&&c(b)})};var a=d.prototype;a.send=function(a,d,f){if(this.script)return!1;var g=this.options.tagPrefix||"_pusher_jsonp_",d=b.Util.extend({},d,{receiver:this.options.receiver}),d=b.Util.map(b.Util.flatten(c(b.Util.filterObject(d,function(a){return a!==void 0}))),b.Util.method("join",
"=")).join("&");this.script=document.createElement("script");this.script.id=g+a;this.script.src=this.options.url+"/"+a+"?"+d;this.script.type="text/javascript";this.script.charset="UTF-8";this.script.onerror=this.script.onload=f;if(this.script.async===void 0&&document.attachEvent&&/opera/i.test(navigator.userAgent))g=this.options.receiver||"Pusher.JSONP.receive",this.errorScript=document.createElement("script"),this.errorScript.text=g+"("+a+", true);",this.script.async=this.errorScript.async=!1;var h=
this;this.script.onreadystatechange=function(){h.script&&/loaded|complete/.test(h.script.readyState)&&f(!0)};a=document.getElementsByTagName("head")[0];a.insertBefore(this.script,a.firstChild);this.errorScript&&a.insertBefore(this.errorScript,this.script.nextSibling);return!0};a.cleanup=function(){if(this.script&&this.script.parentNode)this.script.parentNode.removeChild(this.script),this.script=null;if(this.errorScript&&this.errorScript.parentNode)this.errorScript.parentNode.removeChild(this.errorScript),
this.errorScript=null};b.JSONPRequest=d}).call(this);(function(){function d(){this.lastId=0;this.callbacks={}}var c=d.prototype;c.register=function(a){this.lastId++;var b=this.lastId;this.callbacks[b]=a;return b};c.unregister=function(a){if(this.callbacks[a]){var b=this.callbacks[a];delete this.callbacks[a];return b}else return null};c.receive=function(a,b,c){(a=this.unregister(a))&&a(b,c)};b.JSONPReceiver=d;b.JSONP=new d}).call(this);(function(){function d(a,b,c){this.key=a;this.session=b;this.events=
[];this.options=c||{};this.uniqueID=this.sent=0}var c=d.prototype;d.ERROR=3;d.INFO=6;d.DEBUG=7;c.log=function(a,c){if(this.options.level===void 0||a<=this.options.level)this.events.push(b.Util.extend({},c,{timestamp:b.Util.now(),level:a})),this.options.limit&&this.events.length>this.options.limit&&this.events.shift()};c.error=function(a){this.log(d.ERROR,a)};c.info=function(a){this.log(d.INFO,a)};c.debug=function(a){this.log(d.DEBUG,a)};c.isEmpty=function(){return this.events.length===0};c.send=function(a,
c){var d=this,f={};this.sent===0&&(f=b.Util.extend({key:this.key,features:this.options.features,version:this.options.version},this.options.params||{}));f.session=this.session;f.timeline=this.events;f=b.Util.filterObject(f,function(a){return a!==void 0});this.events=[];a(f,function(a,b){a||d.sent++;c(a,b)});return!0};c.generateUniqueID=function(){this.uniqueID++;return this.uniqueID};b.Timeline=d}).call(this);(function(){function d(a,b){this.timeline=a;this.options=b||{}}var c=d.prototype;c.send=function(a){if(!this.timeline.isEmpty()){var c=
this.options,d="http"+(this.isEncrypted()?"s":"")+"://";this.timeline.send(function(a,g){return b.JSONPRequest.send({data:a,url:d+c.host+c.path,receiver:b.JSONP},g)},a)}};c.isEncrypted=function(){return!!this.options.encrypted};b.TimelineSender=d}).call(this);(function(){function d(a){this.strategies=a}function c(a,c,d){var i=b.Util.map(a,function(a,b,e,i){return a.connect(c,d(b,i))});return{abort:function(){b.Util.apply(i,e)},forceMinPriority:function(a){b.Util.apply(i,function(b){b.forceMinPriority(a)})}}}
function a(a){return b.Util.all(a,function(a){return Boolean(a.error)})}function e(a){if(!a.error&&!a.aborted)a.abort(),a.aborted=!0}var i=d.prototype;i.isSupported=function(){return b.Util.any(this.strategies,b.Util.method("isSupported"))};i.connect=function(e,d){return c(this.strategies,e,function(c,e){return function(i,f){(e[c].error=i)?a(e)&&d(!0):(b.Util.apply(e,function(a){a.forceMinPriority(f.transport.priority)}),d(null,f))}})};b.BestConnectedEverStrategy=d}).call(this);(function(){function d(a,
b,c){this.strategy=a;this.transports=b;this.ttl=c.ttl||18E5;this.timeline=c.timeline}function c(){var a=b.Util.getLocalStorage();return a&&a.pusherTransport?JSON.parse(a.pusherTransport):null}var a=d.prototype;a.isSupported=function(){return this.strategy.isSupported()};a.connect=function(a,d){var f=c(),g=[this.strategy];if(f&&f.timestamp+this.ttl>=b.Util.now()){var h=this.transports[f.transport];h&&(this.timeline.info({cached:!0,transport:f.transport}),g.push(new b.SequentialStrategy([h],{timeout:f.latency*
2,failFast:!0})))}var j=b.Util.now(),k=g.pop().connect(a,function l(c,h){if(c){var f=b.Util.getLocalStorage();if(f&&f.pusherTransport)try{delete f.pusherTransport}catch(r){f.pusherTransport=void 0}g.length>0?(j=b.Util.now(),k=g.pop().connect(a,l)):d(c)}else{var f=b.Util.now()-j,q=h.transport.name,p=b.Util.getLocalStorage();if(p)try{p.pusherTransport=JSON.stringify({timestamp:b.Util.now(),transport:q,latency:f})}catch(s){}d(null,h)}});return{abort:function(){k.abort()},forceMinPriority:function(b){a=
b;k&&k.forceMinPriority(b)}}};b.CachedStrategy=d}).call(this);(function(){function d(a,b){this.strategy=a;this.options={delay:b.delay}}var c=d.prototype;c.isSupported=function(){return this.strategy.isSupported()};c.connect=function(a,c){var d=this.strategy,f,g=new b.Timer(this.options.delay,function(){f=d.connect(a,c)});return{abort:function(){g.ensureAborted();f&&f.abort()},forceMinPriority:function(b){a=b;f&&f.forceMinPriority(b)}}};b.DelayedStrategy=d}).call(this);(function(){function d(a){this.strategy=
a}var c=d.prototype;c.isSupported=function(){return this.strategy.isSupported()};c.connect=function(a,b){var c=this.strategy.connect(a,function(a,d){d&&c.abort();b(a,d)});return c};b.FirstConnectedStrategy=d}).call(this);(function(){function d(a,b,c){this.test=a;this.trueBranch=b;this.falseBranch=c}var c=d.prototype;c.isSupported=function(){return(this.test()?this.trueBranch:this.falseBranch).isSupported()};c.connect=function(a,b){return(this.test()?this.trueBranch:this.falseBranch).connect(a,b)};
b.IfStrategy=d}).call(this);(function(){function d(a,b){this.strategies=a;this.loop=Boolean(b.loop);this.failFast=Boolean(b.failFast);this.timeout=b.timeout;this.timeoutLimit=b.timeoutLimit}var c=d.prototype;c.isSupported=function(){return b.Util.any(this.strategies,b.Util.method("isSupported"))};c.connect=function(a,b){var c=this,d=this.strategies,g=0,h=this.timeout,j=null,k=function(n,l){l?b(null,l):(g+=1,c.loop&&(g%=d.length),g<d.length?(h&&(h*=2,c.timeoutLimit&&(h=Math.min(h,c.timeoutLimit))),
j=c.tryStrategy(d[g],a,{timeout:h,failFast:c.failFast},k)):b(!0))},j=this.tryStrategy(d[g],a,{timeout:h,failFast:this.failFast},k);return{abort:function(){j.abort()},forceMinPriority:function(b){a=b;j&&j.forceMinPriority(b)}}};c.tryStrategy=function(a,c,d,f){var g=null,h=null,h=a.connect(c,function(a,b){if(!a||!g||!g.isRunning()||d.failFast)g&&g.ensureAborted(),f(a,b)});d.timeout>0&&(g=new b.Timer(d.timeout,function(){h.abort();f(!0)}));return{abort:function(){g&&g.ensureAborted();h.abort()},forceMinPriority:function(a){h.forceMinPriority(a)}}};
b.SequentialStrategy=d}).call(this);(function(){function d(a,b,c,d){this.name=a;this.priority=b;this.transport=c;this.options=d||{}}function c(a,c){new b.Timer(0,function(){c(a)});return{abort:function(){},forceMinPriority:function(){}}}var a=d.prototype;a.isSupported=function(){return this.transport.isSupported({disableFlash:!!this.options.disableFlash})};a.connect=function(a,d){if(this.transport.isSupported()){if(this.priority<a)return c(new b.Errors.TransportPriorityTooLow,d)}else return c(new b.Errors.UnsupportedStrategy,
d);var f=this,g=!1,h=this.transport.createConnection(this.name,this.priority,this.options.key,this.options),j=null,k=function(){h.unbind("initialized",k);h.connect()},n=function(){j=new b.Handshake(h,function(a){g=!0;o();d(null,a)})},l=function(a){o();d(a)},m=function(){o();d(new b.Errors.TransportClosed(h))},o=function(){h.unbind("initialized",k);h.unbind("open",n);h.unbind("error",l);h.unbind("closed",m)};h.bind("initialized",k);h.bind("open",n);h.bind("error",l);h.bind("closed",m);h.initialize();
return{abort:function(){g||(o(),j?j.close():h.close())},forceMinPriority:function(a){g||f.priority<a&&(j?j.close():h.close())}}};b.TransportStrategy=d}).call(this);(function(){function d(a,c,d,g){b.EventsDispatcher.call(this);this.name=a;this.priority=c;this.key=d;this.state="new";this.timeline=g.timeline;this.id=this.timeline.generateUniqueID();this.options={encrypted:Boolean(g.encrypted),hostUnencrypted:g.hostUnencrypted,hostEncrypted:g.hostEncrypted}}function c(a){return typeof a==="string"?a:
typeof a==="object"?b.Util.mapObject(a,function(a){var b=typeof a;return b==="object"||b=="function"?b:a}):typeof a}var a=d.prototype;b.Util.extend(a,b.EventsDispatcher.prototype);d.isSupported=function(){return!1};a.supportsPing=function(){return!1};a.initialize=function(){this.timeline.info(this.buildTimelineMessage({transport:this.name+(this.options.encrypted?"s":"")}));this.timeline.debug(this.buildTimelineMessage({method:"initialize"}));this.changeState("initialized")};a.connect=function(){var a=
this.getURL(this.key,this.options);this.timeline.debug(this.buildTimelineMessage({method:"connect",url:a}));if(this.socket||this.state!=="initialized")return!1;try{this.socket=this.createSocket(a)}catch(c){var d=this;new b.Timer(0,function(){d.onError(c);d.changeState("closed")});return!1}this.bindListeners();b.debug("Connecting",{transport:this.name,url:a});this.changeState("connecting");return!0};a.close=function(){this.timeline.debug(this.buildTimelineMessage({method:"close"}));return this.socket?
(this.socket.close(),!0):!1};a.send=function(a){this.timeline.debug(this.buildTimelineMessage({method:"send",data:a}));if(this.state==="open"){var b=this;setTimeout(function(){b.socket.send(a)},0);return!0}else return!1};a.requestPing=function(){this.emit("ping_request")};a.onOpen=function(){this.changeState("open");this.socket.onopen=void 0};a.onError=function(a){this.emit("error",{type:"WebSocketError",error:a});this.timeline.error(this.buildTimelineMessage({error:c(a)}))};a.onClose=function(a){this.changeState("closed",
a);this.socket=void 0};a.onMessage=function(a){this.timeline.debug(this.buildTimelineMessage({message:a.data}));this.emit("message",a)};a.bindListeners=function(){var a=this;this.socket.onopen=function(){a.onOpen()};this.socket.onerror=function(b){a.onError(b)};this.socket.onclose=function(b){a.onClose(b)};this.socket.onmessage=function(b){a.onMessage(b)}};a.createSocket=function(){return null};a.getScheme=function(){return this.options.encrypted?"wss":"ws"};a.getBaseURL=function(){var a;a=this.options.encrypted?
this.options.hostEncrypted:this.options.hostUnencrypted;return this.getScheme()+"://"+a};a.getPath=function(){return"/app/"+this.key};a.getQueryString=function(){return"?protocol="+b.PROTOCOL+"&client=js&version="+b.VERSION};a.getURL=function(){return this.getBaseURL()+this.getPath()+this.getQueryString()};a.changeState=function(a,b){this.state=a;this.timeline.info(this.buildTimelineMessage({state:a,params:b}));this.emit(a,b)};a.buildTimelineMessage=function(a){return b.Util.extend({cid:this.id},
a)};b.AbstractTransport=d}).call(this);(function(){function d(a,c,d,f){b.AbstractTransport.call(this,a,c,d,f)}var c=d.prototype;b.Util.extend(c,b.AbstractTransport.prototype);d.createConnection=function(a,b,c,f){return new d(a,b,c,f)};d.isSupported=function(a){if(a&&a.disableFlash)return!1;try{return Boolean(new ActiveXObject("ShockwaveFlash.ShockwaveFlash"))}catch(b){return Boolean(navigator&&navigator.mimeTypes&&navigator.mimeTypes["application/x-shockwave-flash"]!==void 0)}};c.initialize=function(){var a=
this;this.timeline.info(this.buildTimelineMessage({transport:this.name+(this.options.encrypted?"s":"")}));this.timeline.debug(this.buildTimelineMessage({method:"initialize"}));this.changeState("initializing");if(window.WEB_SOCKET_SUPPRESS_CROSS_DOMAIN_SWF_ERROR===void 0)window.WEB_SOCKET_SUPPRESS_CROSS_DOMAIN_SWF_ERROR=!0;window.WEB_SOCKET_SWF_LOCATION=b.Dependencies.getRoot()+"/WebSocketMain.swf";b.Dependencies.load("flashfallback",function(){a.changeState("initialized")})};c.createSocket=function(a){return new FlashWebSocket(a)};
c.getQueryString=function(){return b.AbstractTransport.prototype.getQueryString.call(this)+"&flash=true"};b.FlashTransport=d}).call(this);(function(){function d(a,c,d,f){b.AbstractTransport.call(this,a,c,d,f);this.options.ignoreNullOrigin=f.ignoreNullOrigin}var c=d.prototype;b.Util.extend(c,b.AbstractTransport.prototype);d.createConnection=function(a,b,c,f){return new d(a,b,c,f)};d.isSupported=function(){return!0};c.initialize=function(){var a=this;this.timeline.info(this.buildTimelineMessage({transport:this.name+
(this.options.encrypted?"s":"")}));this.timeline.debug(this.buildTimelineMessage({method:"initialize"}));this.changeState("initializing");b.Dependencies.load("sockjs",function(){a.changeState("initialized")})};c.supportsPing=function(){return!0};c.createSocket=function(a){return new SockJS(a,null,{js_path:b.Dependencies.getPath("sockjs",{encrypted:this.options.encrypted}),ignore_null_origin:this.options.ignoreNullOrigin})};c.getScheme=function(){return this.options.encrypted?"https":"http"};c.getPath=
function(){return"/pusher"};c.getQueryString=function(){return""};c.onOpen=function(){this.socket.send(JSON.stringify({path:b.AbstractTransport.prototype.getPath.call(this)+b.AbstractTransport.prototype.getQueryString.call(this)}));this.changeState("open");this.socket.onopen=void 0};b.SockJSTransport=d}).call(this);(function(){function d(a,c,d,f){b.AbstractTransport.call(this,a,c,d,f)}var c=d.prototype;b.Util.extend(c,b.AbstractTransport.prototype);d.createConnection=function(a,b,c,f){return new d(a,
b,c,f)};d.isSupported=function(){return window.WebSocket!==void 0||window.MozWebSocket!==void 0};c.createSocket=function(a){return new (window.WebSocket||window.MozWebSocket)(a)};c.getQueryString=function(){return b.AbstractTransport.prototype.getQueryString.call(this)+"&flash=false"};b.WSTransport=d}).call(this);(function(){function d(a,c,d){this.manager=a;this.transport=c;this.minPingDelay=d.minPingDelay||1E4;this.maxPingDelay=d.maxPingDelay||b.activity_timeout;this.pingDelay=null}var c=d.prototype;
c.createConnection=function(a,c,d,f){var g=this.transport.createConnection(a,c,d,f),h=this,j=null,k=null,n=function(){g.unbind("open",n);j=b.Util.now();h.pingDelay&&(k=setInterval(function(){k&&g.requestPing()},h.pingDelay));g.bind("closed",l)},l=function(a){g.unbind("closed",l);k&&(clearInterval(k),k=null);if(!a.wasClean&&j&&(a=b.Util.now()-j,a<2*h.maxPingDelay))h.manager.reportDeath(),h.pingDelay=Math.max(a/2,h.minPingDelay)};g.bind("open",n);return g};c.isSupported=function(a){return this.manager.isAlive()&&
this.transport.isSupported(a)};b.AssistantToTheTransportManager=d}).call(this);(function(){function d(a){this.options=a||{};this.livesLeft=this.options.lives||Infinity}var c=d.prototype;c.getAssistant=function(a){return new b.AssistantToTheTransportManager(this,a,{minPingDelay:this.options.minPingDelay,maxPingDelay:this.options.maxPingDelay})};c.isAlive=function(){return this.livesLeft>0};c.reportDeath=function(){this.livesLeft-=1};b.TransportManager=d}).call(this);(function(){function d(a){return function(b){return[a.apply(this,
arguments),b]}}function c(a,b){if(a.length===0)return[[],b];var d=e(a[0],b),f=c(a.slice(1),d[1]);return[[d[0]].concat(f[0]),f[1]]}function a(a,d){if(typeof a[0]==="string"&&a[0].charAt(0)===":"){var f=d[a[0].slice(1)];if(a.length>1){if(typeof f!=="function")throw"Calling non-function "+a[0];var i=[b.Util.extend({},d)].concat(b.Util.map(a.slice(1),function(a){return e(a,b.Util.extend({},d))[0]}));return f.apply(this,i)}else return[f,d]}else return c(a,d)}function e(b,c){if(typeof b==="string"){var d;
if(typeof b==="string"&&b.charAt(0)===":"){d=c[b.slice(1)];if(d===void 0)throw"Undefined symbol "+b;d=[d,c]}else d=[b,c];return d}else if(typeof b==="object"&&b instanceof Array&&b.length>0)return a(b,c);return[b,c]}var i={ws:b.WSTransport,flash:b.FlashTransport,sockjs:b.SockJSTransport},f={def:function(a,b,c){if(a[b]!==void 0)throw"Redefining symbol "+b;a[b]=c;return[void 0,a]},def_transport:function(a,c,d,e,f,l){var m=i[d];if(!m)throw new b.Errors.UnsupportedTransport(d);d=b.Util.extend({},{key:a.key,
encrypted:a.encrypted,timeline:a.timeline,disableFlash:a.disableFlash,ignoreNullOrigin:a.ignoreNullOrigin},f);l&&(m=l.getAssistant(m));e=new b.TransportStrategy(c,e,m,d);l=a.def(a,c,e)[1];l.transports=a.transports||{};l.transports[c]=e;return[void 0,l]},transport_manager:d(function(a,c){return new b.TransportManager(c)}),sequential:d(function(a,c){var d=Array.prototype.slice.call(arguments,2);return new b.SequentialStrategy(d,c)}),cached:d(function(a,c,d){return new b.CachedStrategy(d,a.transports,
{ttl:c,timeline:a.timeline})}),first_connected:d(function(a,c){return new b.FirstConnectedStrategy(c)}),best_connected_ever:d(function(){var a=Array.prototype.slice.call(arguments,1);return new b.BestConnectedEverStrategy(a)}),delayed:d(function(a,c,d){return new b.DelayedStrategy(d,{delay:c})}),"if":d(function(a,c,d,e){return new b.IfStrategy(c,d,e)}),is_supported:d(function(a,b){return function(){return b.isSupported()}})};b.StrategyBuilder={build:function(a,c){var d=b.Util.extend({},f,c);return e(a,
d)[1].strategy}}}).call(this);(function(){Protocol={decodeMessage:function(b){try{var c=JSON.parse(b.data);if(typeof c.data==="string")try{c.data=JSON.parse(c.data)}catch(a){if(!(a instanceof SyntaxError))throw a;}return c}catch(e){throw{type:"MessageParseError",error:e,data:b.data};}},encodeMessage:function(b){return JSON.stringify(b)},processHandshake:function(b){b=this.decodeMessage(b);if(b.event==="pusher:connection_established")return{action:"connected",id:b.data.socket_id};else if(b.event===
"pusher:error")return{action:this.getCloseAction(b.data),error:this.getCloseError(b.data)};else throw"Invalid handshake";},getCloseAction:function(b){return b.code<4E3?b.code>=1002&&b.code<=1004?"backoff":null:b.code===4E3?"ssl_only":b.code<4100?"refused":b.code<4200?"backoff":b.code<4300?"retry":"refused"},getCloseError:function(b){return b.code!==1E3&&b.code!==1001?{type:"PusherError",data:{code:b.code,message:b.reason||b.message}}:null}};b.Protocol=Protocol}).call(this);(function(){function d(a,
c){b.EventsDispatcher.call(this);this.id=a;this.transport=c;this.bindListeners()}var c=d.prototype;b.Util.extend(c,b.EventsDispatcher.prototype);c.supportsPing=function(){return this.transport.supportsPing()};c.send=function(a){return this.transport.send(a)};c.send_event=function(a,c,d){a={event:a,data:c};if(d)a.channel=d;b.debug("Event sent",a);return this.send(b.Protocol.encodeMessage(a))};c.close=function(){this.transport.close()};c.bindListeners=function(){var a=this,c=function(c){var d;try{d=
b.Protocol.decodeMessage(c)}catch(e){a.emit("error",{type:"MessageParseError",error:e,data:c.data})}if(d!==void 0){b.debug("Event recd",d);switch(d.event){case "pusher:error":a.emit("error",{type:"PusherError",data:d.data});break;case "pusher:ping":a.emit("ping");break;case "pusher:pong":a.emit("pong")}a.emit("message",d)}},d=function(){a.emit("ping_request")},f=function(b){a.emit("error",{type:"WebSocketError",error:b})},g=function(b){a.transport.unbind("closed",g);a.transport.unbind("error",f);
a.transport.unbind("ping_request",d);a.transport.unbind("message",c);b&&b.code&&a.handleCloseEvent(b);a.transport=null;a.emit("closed")};a.transport.bind("message",c);a.transport.bind("ping_request",d);a.transport.bind("error",f);a.transport.bind("closed",g)};c.handleCloseEvent=function(a){var c=b.Protocol.getCloseAction(a);(a=b.Protocol.getCloseError(a))&&this.emit("error",a);c&&this.emit(c)};b.Connection=d}).call(this);(function(){function d(a,b){this.transport=a;this.callback=b;this.bindListeners()}
var c=d.prototype;c.close=function(){this.unbindListeners();this.transport.close()};c.bindListeners=function(){var a=this;a.onMessage=function(c){a.unbindListeners();try{var d=b.Protocol.processHandshake(c);d.action==="connected"?a.finish("connected",{connection:new b.Connection(d.id,a.transport)}):(a.finish(d.action,{error:d.error}),a.transport.close())}catch(f){a.finish("error",{error:f}),a.transport.close()}};a.onClosed=function(c){a.unbindListeners();var d=b.Protocol.getCloseAction(c)||"backoff",
c=b.Protocol.getCloseError(c);a.finish(d,{error:c})};a.transport.bind("message",a.onMessage);a.transport.bind("closed",a.onClosed)};c.unbindListeners=function(){this.transport.unbind("message",this.onMessage);this.transport.unbind("closed",this.onClosed)};c.finish=function(a,c){this.callback(b.Util.extend({transport:this.transport,action:a},c))};b.Handshake=d}).call(this);(function(){function d(a,c){b.EventsDispatcher.call(this);this.key=a;this.options=c||{};this.state="initialized";this.connection=
null;this.encrypted=!!c.encrypted;this.timeline=this.options.getTimeline();this.connectionCallbacks=this.buildConnectionCallbacks();this.errorCallbacks=this.buildErrorCallbacks();this.handshakeCallbacks=this.buildHandshakeCallbacks(this.errorCallbacks);var d=this;b.Network.bind("online",function(){d.timeline.info({netinfo:"online"});d.state==="unavailable"&&d.connect()});b.Network.bind("offline",function(){d.timeline.info({netinfo:"offline"});d.shouldRetry()&&(d.disconnect(),d.updateState("unavailable"))});
var f=function(){d.timelineSender&&d.timelineSender.send(function(){})};this.bind("connected",f);setInterval(f,6E4);this.updateStrategy()}var c=d.prototype;b.Util.extend(c,b.EventsDispatcher.prototype);c.connect=function(){var a=this;if(!a.connection&&a.state!=="connecting")if(a.strategy.isSupported())if(b.Network.isOnline()===!1)a.updateState("unavailable");else{a.updateState("connecting");a.timelineSender=a.options.getTimelineSender(a.timeline,{encrypted:a.encrypted},a);var c=function(b,d){b?a.runner=
a.strategy.connect(0,c):(a.runner.abort(),a.handshakeCallbacks[d.action](d))};a.runner=a.strategy.connect(0,c);a.setUnavailableTimer()}else a.updateState("failed")};c.send=function(a){return this.connection?this.connection.send(a):!1};c.send_event=function(a,b,c){return this.connection?this.connection.send_event(a,b,c):!1};c.disconnect=function(){this.runner&&this.runner.abort();this.clearRetryTimer();this.clearUnavailableTimer();this.stopActivityCheck();this.updateState("disconnected");this.connection&&
(this.connection.close(),this.abandonConnection())};c.updateStrategy=function(){this.strategy=this.options.getStrategy({key:this.key,timeline:this.timeline,encrypted:this.encrypted})};c.retryIn=function(a){var c=this;c.timeline.info({action:"retry",delay:a});c.retryTimer=new b.Timer(a||0,function(){c.disconnect();c.connect()})};c.clearRetryTimer=function(){this.retryTimer&&this.retryTimer.ensureAborted()};c.setUnavailableTimer=function(){var a=this;a.unavailableTimer=new b.Timer(a.options.unavailableTimeout,
function(){a.updateState("unavailable")})};c.clearUnavailableTimer=function(){this.unavailableTimer&&this.unavailableTimer.ensureAborted()};c.resetActivityCheck=function(){this.stopActivityCheck();if(!this.connection.supportsPing()){var a=this;a.activityTimer=new b.Timer(a.options.activityTimeout,function(){a.send_event("pusher:ping",{});a.activityTimer=new b.Timer(a.options.pongTimeout,function(){a.connection.close()})})}};c.stopActivityCheck=function(){this.activityTimer&&this.activityTimer.ensureAborted()};
c.buildConnectionCallbacks=function(){var a=this;return{message:function(b){a.resetActivityCheck();a.emit("message",b)},ping:function(){a.send_event("pusher:pong",{})},ping_request:function(){a.send_event("pusher:ping",{})},error:function(b){a.emit("error",{type:"WebSocketError",error:b})},closed:function(){a.abandonConnection();a.shouldRetry()&&a.retryIn(1E3)}}};c.buildHandshakeCallbacks=function(a){var c=this;return b.Util.extend({},a,{connected:function(a){c.clearUnavailableTimer();c.setConnection(a.connection);
c.socket_id=c.connection.id;c.updateState("connected")}})};c.buildErrorCallbacks=function(){function a(a){return function(c){c.error&&b.emit("error",{type:"WebSocketError",error:c.error});a(c)}}var b=this;return{ssl_only:a(function(){b.encrypted=!0;b.updateStrategy();b.retryIn(0)}),refused:a(function(){b.disconnect()}),backoff:a(function(){b.retryIn(1E3)}),retry:a(function(){b.retryIn(0)})}};c.setConnection=function(a){this.connection=a;for(var b in this.connectionCallbacks)this.connection.bind(b,
this.connectionCallbacks[b]);this.resetActivityCheck()};c.abandonConnection=function(){if(this.connection){for(var a in this.connectionCallbacks)this.connection.unbind(a,this.connectionCallbacks[a]);this.connection=null}};c.updateState=function(a,c){var d=this.state;this.state=a;d!==a&&(b.debug("State changed",d+" -> "+a),this.timeline.info({state:a}),this.emit("state_change",{previous:d,current:a}),this.emit(a,c))};c.shouldRetry=function(){return this.state==="connecting"||this.state==="connected"};
b.ConnectionManager=d}).call(this);(function(){function d(){b.EventsDispatcher.call(this);var c=this;window.addEventListener!==void 0&&(window.addEventListener("online",function(){c.emit("online")},!1),window.addEventListener("offline",function(){c.emit("offline")},!1))}b.Util.extend(d.prototype,b.EventsDispatcher.prototype);d.prototype.isOnline=function(){return window.navigator.onLine===void 0?!0:window.navigator.onLine};b.NetInfo=d;b.Network=new d}).call(this);(function(){b.Channels=function(){this.channels=
{}};b.Channels.prototype={add:function(c,a){var d=this.find(c);d||(d=b.Channel.factory(c,a),this.channels[c]=d);return d},find:function(b){return this.channels[b]},remove:function(b){delete this.channels[b]},disconnect:function(){for(var b in this.channels)this.channels[b].disconnect()}};b.Channel=function(c,a){var d=this;b.EventsDispatcher.call(this,function(a){b.debug("No callbacks on "+c+" for "+a)});this.pusher=a;this.name=c;this.subscribed=!1;this.bind("pusher_internal:subscription_succeeded",
function(a){d.onSubscriptionSucceeded(a)})};b.Channel.prototype={init:function(){},disconnect:function(){this.subscribed=!1;this.emit("pusher_internal:disconnected")},onSubscriptionSucceeded:function(){this.subscribed=!0;this.emit("pusher:subscription_succeeded")},authorize:function(b,a,d){return d(!1,{})},trigger:function(b,a){return this.pusher.send_event(b,a,this.name)}};b.Util.extend(b.Channel.prototype,b.EventsDispatcher.prototype);b.Channel.PrivateChannel={authorize:function(c,a,d){var i=this;
return(new b.Channel.Authorizer(this,b.channel_auth_transport,a)).authorize(c,function(a,b){a||i.emit("pusher_internal:authorized",b);d(a,b)})}};b.Channel.PresenceChannel={init:function(){this.members=new d(this)},onSubscriptionSucceeded:function(){this.subscribed=!0}};var d=function(b){var a=this,d=null,i=function(){a._members_map={};a.count=0;d=a.me=null};i();var f=function(g){a._members_map=g.presence.hash;a.count=g.presence.count;a.me=a.get(d.user_id);b.emit("pusher:subscription_succeeded",a)};
b.bind("pusher_internal:authorized",function(a){d=JSON.parse(a.channel_data);b.bind("pusher_internal:subscription_succeeded",f)});b.bind("pusher_internal:member_added",function(d){a.get(d.user_id)===null&&a.count++;a._members_map[d.user_id]=d.user_info;b.emit("pusher:member_added",a.get(d.user_id))});b.bind("pusher_internal:member_removed",function(d){var e=a.get(d.user_id);e&&(delete a._members_map[d.user_id],a.count--,b.emit("pusher:member_removed",e))});b.bind("pusher_internal:disconnected",function(){i();
b.unbind("pusher_internal:subscription_succeeded",f)})};d.prototype={each:function(b){for(var a in this._members_map)b(this.get(a))},get:function(b){return this._members_map.hasOwnProperty(b)?{id:b,info:this._members_map[b]}:null}};b.Channel.factory=function(c,a){var d=new b.Channel(c,a);c.indexOf("private-")===0?b.Util.extend(d,b.Channel.PrivateChannel):c.indexOf("presence-")===0&&(b.Util.extend(d,b.Channel.PrivateChannel),b.Util.extend(d,b.Channel.PresenceChannel));d.init();return d}}).call(this);
(function(){b.Channel.Authorizer=function(b,a,d){this.channel=b;this.type=a;this.authOptions=(d||{}).auth||{}};b.Channel.Authorizer.prototype={composeQuery:function(b){var b="&socket_id="+encodeURIComponent(b)+"&channel_name="+encodeURIComponent(this.channel.name),a;for(a in this.authOptions.params)b+="&"+encodeURIComponent(a)+"="+encodeURIComponent(this.authOptions.params[a]);return b},authorize:function(c,a){return b.authorizers[this.type].call(this,c,a)}};var d=1;b.auth_callbacks={};b.authorizers=
{ajax:function(c,a){var d;d=b.XHR?new b.XHR:window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");d.open("POST",b.channel_auth_endpoint,!0);d.setRequestHeader("Content-Type","application/x-www-form-urlencoded");for(var i in this.authOptions.headers)d.setRequestHeader(i,this.authOptions.headers[i]);d.onreadystatechange=function(){if(d.readyState==4)if(d.status==200){var c,g=!1;try{c=JSON.parse(d.responseText),g=!0}catch(h){a(!0,"JSON returned from webapp was invalid, yet status code was 200. Data was: "+
d.responseText)}g&&a(!1,c)}else b.warn("Couldn't get auth info from your webapp",d.status),a(!0,d.status)};d.send(this.composeQuery(c));return d},jsonp:function(c,a){this.authOptions.headers!==void 0&&b.warn("Warn","To send headers with the auth request, you must use AJAX, rather than JSONP.");var e=d.toString();d++;var i=document.createElement("script");b.auth_callbacks[e]=function(b){a(!1,b)};i.src=b.channel_auth_endpoint+"?callback="+encodeURIComponent("Pusher.auth_callbacks['"+e+"']")+this.composeQuery(c);
e=document.getElementsByTagName("head")[0]||document.documentElement;e.insertBefore(i,e.firstChild)}}}).call(this);return b});
